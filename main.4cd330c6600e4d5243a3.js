(()=>{"use strict";const e={baseUrl:"https://nomoreparties.co/v1/cohort-mag-4",headers:{authorization:"37fbf8d3-fcee-4506-bb54-03f43938c259","Content-Type":"application/json"}};async function t(t){let{path:o,options:n,errorMessage:r}=t;return fetch(`${e.baseUrl}${o}`,n).then((e=>function(e,t){return e.ok?e.json():Promise.reject(`${t}: ${e.status}`)}(e,r)))}const o={close:new Event("close-popup")};function n(e){if("Escape"===e.key){const e=document.querySelector(".popup_is-opened");e&&e.dispatchEvent(o.close)}}function r(e){let{popupSelector:t,triggerSelector:r,onShowPopup:i,onHidePopup:a}=e;const l=document.querySelector(t),c=document.querySelector(r);if(null===l||null===c)return void console.error("Неверный селектор для попапа и/или триггера",t,r);const s=l.querySelector(".popup__close");if(null!==s)return c.addEventListener("click",d),s.addEventListener("click",u),l.addEventListener("click",(e=>{e.target===l&&u()})),l.addEventListener(o.close.type,u),{show:d,hide:u};function d(){document.addEventListener("keydown",n),l.classList.add("popup_is-animated"),setTimeout((()=>{l.classList.add("popup_is-opened")}),1),"function"==typeof i&&i()}function u(){document.removeEventListener("keydown",n),l.classList.remove("popup_is-opened"),setTimeout((()=>{l.classList.remove("popup_is-animated")}),600),"function"==typeof a&&a()}console.error("В попапе отсутствует кнопка закрыть",t)}const i={formLoading:new Event("form-loading"),formStopLoading:new Event("form-stop-loading")};function a(e,t,o){const n=e.querySelector(`.${t.name}-error`);t.classList.remove(o.inputErrorClass),n.textContent=""}function l(e,t){!function(e){return e.some((e=>!e.validity.valid))}(e)?t.removeAttribute("disabled"):t.setAttribute("disabled","disabled")}function c(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach((o=>{a(e,o,t),o.setCustomValidity("")})),n.setAttribute("disabled","disabled")}function s(e){let{likeButton:t,likeText:o,likeCount:n}=e;t.classList.toggle("card__like-button_is-active"),o.textContent=n}const d={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inputErrorClass:"popup__input_type_error"},u={name:"",description:"",avatar:"",id:""},p={profileName:document.querySelector(".profile__title"),profileDescription:document.querySelector(".profile__description"),profileImage:document.querySelector(".profile__image")},m={form:document.querySelector("form[name='edit-profile']"),name:document.querySelector("input[name='name']"),description:document.querySelector("input[name='description']")},f={form:document.querySelector("form[name='avatar']"),link:document.querySelector("input[name='avatar-link']")},h=r({popupSelector:".popup_type_edit",triggerSelector:".profile__edit-button",onShowPopup:()=>{null!==m.name&&null!==m.description?(m.name.value=u.name,m.description.value=u.description):console.error("Нет необходимого html для отображения данных пользователя в попапе"),c(m.form,d)}}),y=r({popupSelector:".popup_type_edit-avatar",triggerSelector:".profile__image",onShowPopup:()=>{null!==f.link?f.link.value=u.avatar:console.error("Инпут аватара профиля не найден"),c(f.form,d)}});function g(e){u.name=e.name??"",u.description=e.about??"",u.avatar=e.avatar??"",u.id=e._id??"",null!==p.profileName&&null!==p.profileDescription&&null!==p.profileImage?(p.profileName.textContent=u.name,p.profileDescription.textContent=u.description,p.profileImage.style.backgroundImage=`url(${u.avatar})`):console.error("Нет необходимого html для отображения данных пользователя")}const v={cardTemplate:document.querySelector("#card-template"),cardList:document.querySelector(".places__list")},_={form:document.querySelector("form[name='new-place']"),name:document.querySelector("input[name='place-name']"),link:document.querySelector("input[name='link']")},S={form:document.querySelector("form[name='delete-card']"),cardId:document.querySelector("input[name='card-id']"),paragraph:document.querySelector("form[name='delete-card'] p")},k={image:document.querySelector(".popup_type_image .popup__image"),caption:document.querySelector(".popup_type_image .popup__caption")},L=r({popupSelector:".popup_type_new-card",triggerSelector:".profile__add-button",onShowPopup:()=>{!function(e,t){Array.from(e.querySelectorAll(t.inputSelector)).forEach((e=>{e.value=""}))}(_.form,d),c(_.form,d)}}),E=r({popupSelector:".popup_type_delete-card",triggerSelector:".hidden-popup-trigger"}),b=r({popupSelector:".popup_type_image",triggerSelector:".hidden-popup-trigger"});function C(o,n,r){n.classList.contains("card__like-button_is-active")?function(o){let{cardId:n,cardLikeButton:r,likesAmount:i}=o;(async o=>t({path:`/cards/likes/${o}`,options:{method:"DELETE",headers:e.headers},errorMessage:"Ошибка API при убирании лайка карточки"}))(n).then((e=>{s({likeButton:r,likeText:i,likeCount:e.likes.length})})).catch((e=>{console.log(e)}))}({cardId:o,cardLikeButton:n,likesAmount:r}):function(o){let{cardId:n,cardLikeButton:r,likesAmount:i}=o;(async o=>t({path:`/cards/likes/${o}`,options:{method:"PUT",headers:e.headers},errorMessage:"Ошибка API при лайкании карточки"}))(n).then((e=>{s({likeButton:r,likeText:i,likeCount:e.likes.length})})).catch((e=>{console.log(e)}))}({cardId:o,cardLikeButton:n,likesAmount:r})}function q(e,t){null!==k.image&&null!==k.caption?(k.image.src=e,k.image.alt=t,k.caption.textContent=t,b.show()):console.error("Попап картинки карточки не найден")}function A(e,t){null!==S.form&&null!==S.paragraph&&null!==S.cardId?(S.paragraph.textContent=`Вы собираетесь удалить '${t}'.`,S.cardId.value=e,E.show()):console.log("форма удаления карточки не найдена")}function I(e){const t=e.owner._id===u.id,o=e.likes.some((e=>e._id===u.id));return function(e){let{cardTemplate:t,id:o,title:n,imageUrl:r,likesCount:i,showDelete:a,isLiked:l,onLikeButtonClick:c,onImageClick:s,onDeleteClick:d}=e;if(null===t)return void console.error("Темплейт карточки не найден");const u=t.content.cloneNode(!0),p=u.querySelector(".places__item"),m=u.querySelector(".card__image"),f=u.querySelector(".card__delete-button"),h=u.querySelector(".card__title"),y=u.querySelector(".card__like-button"),g=u.querySelector(".card__like-count");return!0!==a&&f.remove(),!0===l&&y.classList.add("card__like-button_is-active"),p.setAttribute("data-id",o),h.textContent=n,m.src=r,m.alt=n,g.textContent=i,y.addEventListener("click",(()=>{"function"==typeof c&&c(o,y,g)})),m.addEventListener("click",(()=>{"function"==typeof s&&s(m.src,n)})),m.addEventListener("error",(()=>{m.src="bfc191ba871c50b18e56.png"})),!0===a&&f.addEventListener("click",(()=>{"function"==typeof d&&d(o,n)})),u}({cardTemplate:v.cardTemplate,id:e._id,title:e.name,imageUrl:e.link,showDelete:t,isLiked:o,likesCount:e.likes.length,onLikeButtonClick:C,onImageClick:q,onDeleteClick:A})}!function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((t=>{!function(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector),r=n.textContent;l(o,n),e.addEventListener("submit",(e=>{e.preventDefault()})),e.addEventListener(i.formLoading.type,(e=>{n.setAttribute("disabled","disabled"),n.textContent="Ждите..."})),e.addEventListener(i.formStopLoading.type,(()=>{n.removeAttribute("disabled"),n.textContent=r})),o.forEach((r=>{r.addEventListener("input",(()=>{!function(e,t,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?a(e,t,o):function(e,t,o,n){const r=e.querySelector(`.${t.name}-error`);t.classList.add(n.inputErrorClass),r.textContent=o}(e,t,t.validationMessage,o)}(e,r,t),l(o,n)}))}))}(t,e)}))}(d),Promise.all([(async()=>t({path:"/users/me",options:{method:"GET",headers:e.headers},errorMessage:"Ошибка API при получении данных пользователя"}))(),(async()=>t({path:"/cards",options:{method:"GET",headers:e.headers},errorMessage:"Ошибка API при получении списка карточек"}))()]).then((e=>{const t=e[0],o=e[1];g(t),function(e){const t=null===v.cardList?(console.error("Контейнер карточек не найден"),document.createElement("div")):v.cardList;e.forEach((e=>{t.append(I(e))}))}(o)})).catch((e=>{console.log(e)})),function(o){let{onUserDataUpdate:n}=o;null!==m.form&&null!==m.name&&null!==m.description?m.form.addEventListener("submit",(o=>{o.preventDefault(),m.form.dispatchEvent(i.formLoading),(async o=>{let{name:n,description:r}=o;return t({path:"/users/me",options:{method:"PATCH",headers:e.headers,body:JSON.stringify({name:n,about:r})},errorMessage:"Ошибка API при обновлении данных пользователя"})})({name:m.name.value,description:m.description.value}).then((e=>{g(e),"function"==typeof n&&n()})).catch((e=>{console.log(e)})).finally((()=>{m.form.dispatchEvent(i.formStopLoading)}))})):console.error("Форма пользователя не найдена")}({onUserDataUpdate:()=>{h.hide()}}),function(o){let{onCardCreation:n}=o;null!==_.form&&null!==_.name&&null!==_.link?_.form.addEventListener("submit",(o=>{o.preventDefault(),_.form.dispatchEvent(i.formLoading),(async o=>{let{name:n,link:r}=o;return t({path:"/cards",options:{method:"POST",headers:e.headers,body:JSON.stringify({name:n,link:r})},errorMessage:"Ошибка API при создании новой карточки"})})({name:_.name.value,link:_.link.value}).then((e=>{var t;t=I(e),v.cardList.prepend(t),"function"==typeof n&&n()})).catch((e=>{console.log(e)})).finally((()=>{_.form.dispatchEvent(i.formStopLoading)}))})):console.error("Форма карточки не найдена")}({onCardCreation:()=>{L.hide()}}),function(o){let{onAvatarDataUpdate:n}=o;null!==f.form&&null!==f.link?f.form.addEventListener("submit",(o=>{o.preventDefault(),f.form.dispatchEvent(i.formLoading),(async o=>{let{link:n}=o;return t({path:"/users/me/avatar",options:{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:n}),errorMessage:"Ошибка API при обновлении аватара"}})})({link:f.link.value}).then((e=>{g(e),"function"==typeof n&&n()})).catch((e=>{console.log(e)})).finally((()=>{f.form.dispatchEvent(i.formStopLoading)}))})):console.error("Форма аватара не найдена")}({onAvatarDataUpdate:()=>{y.hide()}}),function(o){let{onCardDeletion:n}=o;null!==S.form&&null!==S.cardId?S.form.addEventListener("submit",(o=>{o.preventDefault(),S.form.dispatchEvent(i.formLoading),(async o=>t({path:`/cards/${o}`,options:{method:"DELETE",headers:e.headers},errorMessage:"Ошибка API при удалении карточки"}))(S.cardId.value).then((()=>{"function"==typeof n&&n(S.cardId.value)})).catch((e=>{console.log(e)})).finally((()=>{S.form.dispatchEvent(i.formStopLoading)}))})):console.error("Форма удаления карточки не найдена")}({onCardDeletion:e=>{!function(e){const t=document.querySelector(`[data-id='${e}']`);t&&t.remove()}(e),E.hide()}})})();
//# sourceMappingURL=main.4cd330c6600e4d5243a3.js.map